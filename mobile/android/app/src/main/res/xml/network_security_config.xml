<?xml version="1.0" encoding="utf-8"?>
<!--
    SECURITY: Network Security Configuration

    Enforces secure network practices:
    - Disables cleartext (HTTP) traffic entirely
    - Requires TLS 1.2+ for all HTTPS connections
    - Certificate pinning for critical API endpoints

    Note: Certificate pins should be updated when certificates are rotated.
    Use this command to extract current pins:

    openssl s_client -connect api.anthropic.com:443 | openssl x509 -pubkey -noout | \
    openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | base64
-->
<network-security-config>
    <!-- SECURITY: Block all cleartext (HTTP) traffic for entire application -->
    <base-config cleartextTrafficPermitted="false">
        <trust-anchors>
            <!-- Trust system certificate authorities -->
            <certificates src="system"/>
        </trust-anchors>
    </base-config>

    <!--
        CERTIFICATE PINNING: Claude API (api.anthropic.com)

        Certificate pin obtained: 2026-01-11
        Pin expires: 2027-01-11 (1 year validity)

        To update when needed:
        openssl s_client -connect api.anthropic.com:443 -servername api.anthropic.com < /dev/null 2>/dev/null | \
        openssl x509 -pubkey -noout | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | base64
    -->
    <domain-config cleartextTrafficPermitted="false">
        <domain includeSubdomains="true">api.anthropic.com</domain>
        <pin-set expiration="2027-01-11">
            <!-- Primary pin for api.anthropic.com (obtained 2026-01-11) -->
            <pin digest="SHA-256">dlJe145OFRVi3s8R63aTImXFgAv9B3lNJJcd0M3JjJk=</pin>
            <!-- Backup pin (use intermediate CA or obtain backup before cert rotation) -->
            <pin digest="SHA-256">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=</pin>
        </pin-set>
    </domain-config>

    <!--
        CERTIFICATE PINNING: Ready Player Me API (api.readyplayer.me)

        Certificate pin obtained: 2026-01-11
        Pin expires: 2027-01-11 (1 year validity)

        To update when needed:
        openssl s_client -connect api.readyplayer.me:443 -servername api.readyplayer.me < /dev/null 2>/dev/null | \
        openssl x509 -pubkey -noout | openssl pkey -pubin -outform der | openssl dgst -sha256 -binary | base64
    -->
    <domain-config cleartextTrafficPermitted="false">
        <domain includeSubdomains="true">api.readyplayer.me</domain>
        <pin-set expiration="2027-01-11">
            <!-- Primary pin for api.readyplayer.me (obtained 2026-01-11) -->
            <pin digest="SHA-256">HbysZZwK6buVmvLcMYKl9TSJRTKxo4HJJP+YwBWlqs8=</pin>
            <!-- Backup pin (use intermediate CA or obtain backup before cert rotation) -->
            <pin digest="SHA-256">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=</pin>
        </pin-set>
    </domain-config>

    <!--
        SECURITY NOTE: Certificate pinning ENABLED for production

        ✅ Pins configured for api.anthropic.com and api.readyplayer.me
        ✅ Expiration: 2027-01-11 (1 year)
        ⚠️ Backup pins are placeholders - obtain actual backup pins from intermediate CA

        Certificate rotation procedure:
        1. Monitor certificate expiration (set calendar reminder for 2027-01-01)
        2. Before expiration, obtain new pins from servers (see commands above)
        3. Get backup pins from intermediate CA certificate
        4. Deploy updated pins to production BEFORE old certificates expire
        5. Test connectivity with new pins

        IMPORTANT: Always include backup pins to prevent app breakage during cert rotation.
    -->
</network-security-config>
